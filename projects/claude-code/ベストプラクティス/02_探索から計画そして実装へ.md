# 探索から計画、そして実装へ

## 概要

効果的な開発は「調査」と「実装」を分離することから始まる。闇雲にコードを書き始めるのではなく、まず探索し、計画を立て、それから実装に移る。この4段階のワークフローが、間違った問題を解決してしまうリスクを大幅に減らす。

---

## 4段階ワークフロー

### フェーズ1: 探索（プランモード）

プランモードに入り、Claudeにファイルを読ませ、変更を加えずに質問に答えさせる。

```
claude (プランモード)

質問: 「src/authを読んで、セッションとログインの
処理方法を理解して。
あと、シークレット用の環境変数の管理方法も確認して」
```

**ポイント**: この段階では一切変更を加えない。理解に徹する。

### フェーズ2: 計画

Claudeに詳細な実装計画を作成させる。

```
質問: 「Google OAuthを追加したい。
どのファイルを変更する必要がある？
セッションフローはどうなる？
計画を作成して」
```

**成果物**: 変更が必要なファイルのリスト、実装の順序、考慮すべきエッジケース

### フェーズ3: 実装（通常モード）

通常モードに戻り、計画に基づいてClaudeにコードを書かせ、検証する。

```
質問: 「計画通りにOAuthフローを実装して。
コールバックハンドラのテストを書いて、
テストスイートを実行して失敗があれば修正して」
```

### フェーズ4: コミット

```
質問: 「説明的なメッセージでコミットして、PRを開いて」
```

---

## 計画をスキップしてもいい場合

以下のような単純で明確な修正の場合は、直接実行を依頼してOK：

- **タイポの修正**
- **ログ行の追加**
- **変数名の変更**

> 計画のオーバーヘッドが価値を持つのは、アプローチが不確実な場合、複数ファイルにまたがる変更、または不慣れなコードを扱う場合。

---

## プランモードの使い方

### 基本コマンド

```bash
# プランモードに入る
/plan

# 通常モードに戻る
（プランモードで計画を立てた後、実装開始を指示）
```

### プランモードでできること

- ファイルの読み取り
- コードベースの探索
- 質問への回答
- 計画の作成

### プランモードでできないこと

- ファイルの編集
- コマンドの実行（読み取り以外）
- 実際の変更

---

## 実践例: 認証システムの追加

### Step 1: 探索

```
/plan

「このプロジェクトの認証の仕組みを調べて。
- 既存のユーザー管理はある？
- セッション管理はどうなってる？
- 使われてる認証ライブラリは？」
```

### Step 2: 計画

```
「JWTベースの認証を追加したい。計画を立てて：
1. 必要なパッケージ
2. 変更するファイル
3. 実装の順序
4. テスト戦略」
```

### Step 3: 実装

```
「計画に従って実装を開始して。
まずユーザーモデルとauth middlewareから。
各ステップでテストを実行して」
```

---

## なぜこのワークフローが効果的なのか

### 1. コンテキストの効率的な利用

探索フェーズで全体像を把握してから実装に移ることで、手戻りが減る。

### 2. 明確な成功基準

計画段階で「何をもって完了とするか」が明確になる。

### 3. 分離された関心事

- 探索 = 理解
- 計画 = 設計
- 実装 = コーディング
- コミット = 記録

それぞれの段階で異なる思考モードが必要であり、分離することで各段階に集中できる。

---

## まとめ

> 「まず探索し、次に計画し、それから実装せよ」

この原則に従うことで、間違った方向に進むリスクを最小化し、効率的な開発が可能になる。特に複雑なタスクや不慣れなコードベースでは、このワークフローが真価を発揮する。
