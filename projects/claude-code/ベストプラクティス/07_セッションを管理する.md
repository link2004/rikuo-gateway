# セッションを管理する

## 概要

Claude Codeの最大の制約はコンテキストウィンドウだ。コンテキストが埋まると、パフォーマンスが低下する。セッションを効果的に管理することで、常に最高のパフォーマンスを維持できる。

---

## 7.1 早期かつ頻繁に軌道修正する

### ショートカット

| ショートカット | 動作 |
|---------------|------|
| **`Esc`** | Claudeの作業を途中で停止（コンテキストは保持） |
| **`Esc + Esc`** or **`/rewind`** | リワインドメニューを開き、会話とコード状態を復元 |
| **`「それを元に戻して」`** | Claudeに変更を取り消させる |
| **`/clear`** | 無関係なタスク間でコンテキストをリセット |

### ルール

> 同じセッションで同じ問題を2回修正したら、`/clear`して、学んだことを組み込んだより良いプロンプトでやり直す。

---

## 7.2 コンテキストを積極的に管理する

```bash
/clear                    # コンテキストを完全にリセット
/compact <instructions>   # 特定のフォーカスで自動圧縮
```

### 自動圧縮

- コンテキスト制限に近づくとトリガーされる
- **保持**: コードパターン、ファイル状態、重要な決定
- **削除**: 無関係な会話履歴、ファイル内容、古いコマンド

---

## 7.3 サブエージェントで調査を委任

```
サブエージェントを使って、認証システムがトークンリフレッシュを
どう処理しているか調査して。また、再利用すべき既存の
OAuthユーティリティがあるかも確認して。
```

### メリット

- 探索用の別コンテキストウィンドウ
- メイン会話をクリーンに保つ
- サブエージェントがコンテキストを散らかさずに結果を報告

### 検証に使う場合

```
サブエージェントを使ってこのコードのエッジケースをレビューして。
```

---

## 7.4 チェックポイントでリワインド

### アクセス方法

- `Escape`をダブルタップ
- `/rewind`を実行

### 機能

- 会話のみ復元（コード変更は保持）
- コードのみ復元（会話は保持）
- 両方復元
- セッションをまたいで永続化

⚠️ **注意:** Claudeの変更のみ追跡。外部プロセスの変更はgitを使う。

---

## 7.5 会話を再開する

```bash
claude --continue    # 最新の会話を再開
claude --resume      # 最近の会話から選択
```

### セッションの命名

```bash
/rename "oauth-migration"
/rename "debugging-memory-leak"
```

> セッションをブランチのように使う—異なるワークストリーム用に永続的なコンテキストを持たせる。

---

## まとめ

> 「コンテキストは貴重なリソース。賢く管理せよ」

セッション管理は、Claude Codeのパフォーマンスを最大化する鍵。`/clear`で定期的にリセットし、サブエージェントで調査を委任し、チェックポイントを活用して安全に実験しよう。
