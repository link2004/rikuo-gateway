# 環境を設定する

## 概要

Claude Codeは高度にカスタマイズ可能。CLAUDE.md、パーミッション、MCPサーバー、カスタムコマンド、プラグイン、フック、サブエージェント、スキル—これらを適切に設定することで、あなたのワークフローに最適化された開発環境を構築できる。

---

## 5.1 効果的なCLAUDE.mdを書く

### スターターファイルを生成

```bash
/init
```

### CLAUDE.mdの例

```markdown
# コードスタイル
- ES modules構文（import/export）を使用、CommonJS（require）は使わない
- importはできるだけ分割代入する（例: import { foo } from 'bar'）

# ワークフロー
- コード変更の一連の作業が終わったら必ず型チェックを実行
- パフォーマンスのため、テストスイート全体ではなく単一テストを優先
```

### 含めるべきもの

✅ **含める:**
- Claudeが推測できないBashコマンド
- デフォルトと異なるコードスタイルルール
- テスト実行の指示と好みのテストランナー
- リポジトリのエチケット（ブランチ命名、PRの慣習）
- プロジェクト固有のアーキテクチャ決定
- 開発環境の癖（必須の環境変数など）
- よくある落とし穴や非自明な挙動

❌ **含めない:**
- コードを読めばわかること
- Claudeがすでに知っている標準的な言語の慣習
- 詳細なAPIドキュメント（代わりにリンクを貼る）
- 頻繁に変わる情報
- 長い説明やチュートリアル
- 「きれいなコードを書く」のような自明なプラクティス

### 追加ファイルのインポート

```markdown
プロジェクト概要は @README.md、npmコマンドは @package.json を参照。

# 追加指示
- Git ワークフロー: @docs/git-instructions.md
- 個人設定: @~/.claude/my-project-instructions.md
```

### CLAUDE.mdの配置場所

| 場所 | 用途 |
|------|------|
| `~/.claude/CLAUDE.md` | すべてのセッションに適用 |
| `./CLAUDE.md` | プロジェクトルート（gitにコミット、またはチームと共有、または`CLAUDE.local.md`として.gitignore） |
| 親ディレクトリ | モノレポで便利 |
| 子ディレクトリ | Claudeがオンデマンドで読み込み |

---

## 5.2 パーミッションの設定

```bash
/permissions
```

2つのアプローチ:
- **パーミッション許可リスト**: 安全とわかっている特定のツールを許可
- **サンドボックス**: OSレベルの分離を有効化

### 危険なコマンド（注意）

```bash
claude --dangerously-skip-permissions
```

⚠️ インターネットアクセスのないサンドボックスでのみ使用。

---

## 5.3 CLIツールの活用

Claudeに以下のCLIツールを使わせる:
- `gh` - GitHub CLI
- `aws` - AWS CLI
- `gcloud` - Google Cloud CLI
- `sentry-cli` - Sentry CLI

プロンプト例:
```
'foo-cli-tool --help'を使ってfooツールについて学び、それを使ってA、B、Cを解決して。
```

---

## 5.4 MCPサーバーの接続

```bash
claude mcp add
```

以下と統合可能:
- Notion
- Figma
- データベース
- モニタリングツール
- Issueトラッカー

---

## 5.5 カスタムスラッシュコマンド

**場所:** `.claude/commands/`（プロジェクト）または `~/.claude/commands/`（グローバル）

### 例: .claude/commands/fix-github-issue.md

```markdown
---
description: GitHub issueを修正
---
GitHub issue: $ARGUMENTS を分析して修正してください。

以下の手順に従ってください:
1. `gh issue view`でissueの詳細を取得
2. issueに記述された問題を理解
3. 関連ファイルをコードベースから検索
4. 問題を修正するために必要な変更を実装
5. 修正を検証するテストを書いて実行
6. リントと型チェックをパス
7. 説明的なコミットメッセージを作成
8. プッシュしてPRを作成
```

**使用方法:**
```bash
/fix-github-issue 1234
```

**特殊キーワード:**
- `$ARGUMENTS` - すべてのパラメータを渡す
- `$1`, `$2`, etc. - 位置引数

---

## 5.6 プラグインのインストール

```bash
/plugin
```

マーケットプレイスで事前構築された機能を閲覧:
- 特定ワークフロー用のカスタムコマンド
- 事前設定済みのMCPサーバー
- 専門化されたサブエージェント
- ドメイン知識スキル

---

## 5.7 フックの設定

```bash
/hooks
```

ワークフローの特定のポイントでスクリプトを自動実行:

**ユースケース:**
- 編集後の自動フォーマット
- 変更ファイルのリント
- 機密ファイルへの変更をブロック
- すべてのコマンドをログ
- Claudeが待機中に通知

**プロンプト例:**
```
ファイル編集後にeslintを実行するフックを書いて
migrationsフォルダへの書き込みをブロックするフックを書いて
```

**設定方法:**
- インタラクティブ: `/hooks`
- 手動: `.claude/settings.json`を編集

### フックとCLAUDE.mdの使い分け

| 機能 | 特徴 |
|------|------|
| **フック** | 決定論的制御（必ず実行される） |
| **CLAUDE.md** | アドバイス的ガイダンス（判断ベース） |

---

## 5.8 カスタムサブエージェント

**場所:** `.claude/agents/`

### 例: .claude/agents/security-reviewer.md

```markdown
---
name: security-reviewer
description: セキュリティ脆弱性のコードレビュー
tools: Read, Grep, Glob, Bash
model: opus
---
あなたはシニアセキュリティエンジニアです。以下の観点でコードをレビューしてください:
- インジェクション脆弱性（SQL、XSS、コマンドインジェクション）
- 認証・認可の欠陥
- コード内のシークレットや認証情報
- 安全でないデータ処理

具体的な行番号の参照と修正案を提供してください。
```

**使用方法:**
```
サブエージェントを使ってこのコードのセキュリティ問題をレビューして。
```

**ユースケース:**
- メイン会話のバイアスなしでコードレビュー
- 不慣れなコードの調査
- 専門タスク（セキュリティ、ドキュメント、テスト）
- メインエージェントの作業の検証

---

## 5.9 エージェントスキル

**場所:** `.claude/skills/`

### 例: .claude/skills/api-conventions.md

```markdown
---
name: api-conventions
description: サービスのREST API設計規約
---
# API規約
- URLパスにはケバブケースを使用
- JSONプロパティにはキャメルケースを使用
- リストエンドポイントには必ずページネーションを含める
- URLパスでAPIをバージョニング（/v1/、/v2/）
```

### 機能の使い分け

| 機能 | トリガー | 最適な用途 |
|------|----------|------------|
| CLAUDE.md | 常に読み込み | グローバルなプロジェクトコンテキスト |
| スラッシュコマンド | 明示的な`/command` | 繰り返しワークフロー |
| スキル | コンテキスト（自動） | ドメイン知識 |
| サブエージェント | 委任 | 分離されたタスク |

---

## まとめ

> 「環境設定は一度の投資で継続的なリターンを生む」

CLAUDE.md、パーミッション、フック、カスタムコマンド、サブエージェント、スキル—これらを適切に設定することで、Claude Codeはあなた専用の開発環境に進化する。
